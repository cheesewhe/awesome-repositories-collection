name: Auto-Translate READMEs

# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–≤–æ–¥ README.md –Ω–∞ —Ä—É—Å—Å–∫–∏–π, –∫–∏—Ç–∞–π—Å–∫–∏–π –∏ –∏—Å–ø–∞–Ω—Å–∫–∏–π —è–∑—ã–∫–∏
# –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ README.md —Ñ–∞–π–ª–∞

on:
  push:
    branches:
      - main
    paths:
      - 'README.md'
  workflow_dispatch:
    inputs:
      source_language:
        description: 'Source language (en, ru, zh-CN, es)'
        required: true
        default: 'en'
        type: choice
        options:
          - en
          - ru
          - zh-CN
          - es
      target_languages:
        description: 'Target languages (comma-separated: en,ru,zh-CN,es)'
        required: true
        default: 'ru,zh-CN,es'

jobs:
  translate-readmes:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v5
        with:
          fetch-depth: 0
          token: ${{ secrets.GITHUB_TOKEN }}
      
      - name: Set up Python
        uses: actions/setup-python@v6
        with:
          python-version: '3.11'
          cache: 'pip'
          cache-dependency-path: 'requirements.txt'
      
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
      
      - name: Install argostranslate language models
        run: |
          echo "üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —è–∑—ã–∫–æ–≤—ã—Ö –º–æ–¥–µ–ª–µ–π –¥–ª—è argostranslate..."
          python -c "
          import argostranslate.package
          import argostranslate.translate
          
          # –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –ø–∞–∫–µ—Ç–æ–≤
          argostranslate.package.update_package_index()
          available_packages = argostranslate.package.get_available_packages()
          
          # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —è–∑—ã–∫–æ–≤—ã–µ –ø–∞—Ä—ã
          packages_to_install = [
              ('en', 'ru'),
              ('en', 'zh'),
              ('en', 'es'),
          ]
          
          for from_code, to_code in packages_to_install:
              package = next(
                  (pkg for pkg in available_packages 
                   if pkg.from_code == from_code and pkg.to_code == to_code),
                  None
              )
              if package:
                  print(f'üì• –£—Å—Ç–∞–Ω–æ–≤–∫–∞ {from_code} ‚Üí {to_code}...')
                  try:
                      argostranslate.package.install_from_path(package.download())
                      print(f'‚úÖ {from_code} ‚Üí {to_code} —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ')
                  except Exception as e:
                      print(f'‚ö†Ô∏è –û—à–∏–±–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ {from_code} ‚Üí {to_code}: {e}')
              else:
                  print(f'‚ö†Ô∏è –ü–∞–∫–µ—Ç {from_code} ‚Üí {to_code} –Ω–µ –Ω–∞–π–¥–µ–Ω')
          "
      
      - name: Run translation (AST-based)
        env:
          SOURCE_LANG: ${{ github.event.inputs.source_language || 'en' }}
          TARGET_LANGS: ${{ github.event.inputs.target_languages || 'ru,zh-CN,es' }}
        run: |
          echo "üöÄ –ó–∞–ø—É—Å–∫ —É–ª—É—á—à–µ–Ω–Ω–æ–≥–æ –ø–µ—Ä–µ–≤–æ–¥–∞ —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º Markdown —Å—Ç—Ä—É–∫—Ç—É—Ä—ã..."
          python scripts/translate_readmes_ast.py
      
      - name: Commit and push translations
        run: |
          git config --local user.email "github-actions[bot]@users.noreply.github.com"
          git config --local user.name "github-actions[bot]"
          
          # –î–æ–±–∞–≤–ª—è–µ–º –ø–µ—Ä–µ–≤–µ–¥–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
          git add README.ru.md README.zh-CN.md README.es.md
          
          # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è
          if git diff --staged --quiet; then
            echo "‚ú® –ù–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–ª—è –∫–æ–º–º–∏—Ç–∞"
          else
            echo "üìù –ö–æ–º–º–∏—Ç –ø–µ—Ä–µ–≤–æ–¥–æ–≤..."
            git commit -m "üåç chore: auto-update README translations [skip ci]"
            git push
            echo "‚úÖ –ü–µ—Ä–µ–≤–æ–¥—ã —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω—ã!"
          fi
